#include <Wire.h>
#include <SD.h>

File rdFile;
File opnNext;
String topFile;

String IncData;
char CharData[50];

void setup(){
 
  Serial.begin(9600);
  delay(3000);
  Serial.println("Starting...");
  Serial.print("Initializing SD card...");
  pinMode(10, OUTPUT);
  if (!SD.begin(10)){
    Serial.println("initialization failed!");
    Serial.println("Stopping program.");
    while(1);
  }
  Serial.println("done!");
  Serial.println("Waiting for input");
  
}

void loop(){
 
  while (Serial.available() == 0){
  }
  delay(300);
  //Serial.println(Serial.available());
  int j = 0;
  for (int a = Serial.available(); a != 0; a--){ 
   CharData[j] = Serial.read();
   //Serial.print(j);
   //Serial.println(CharData[j]);
   j++;
   //Serial.println("for done");
  }
  /*
  Serial.println(Serial.available());
  Serial.println("Done!");
  Serial.println(Serial.available());
  */
  int q = 0;  //keroo kuinka monta kertaa wlempi while mennyt l√§pi
  switch (CharData[0]){
    case 'd':
      Serial.println("IT WORKS!");
      while (true){
      rdFile = SD.open("/");
      opnNext = rdFile.openNextFile();
      if (! opnNext){
        Serial.println("All files listed!!!");
        opnNext.close();
        break;
      }
      if (!opnNext.isDirectory()){
        Serial.print(opnNext.name());
        Serial.print("\t");
        Serial.println(opnNext.size(), DEC);
        opnNext.close();
        }
      }
        break;
    default:
      Serial.print("Failed");
      break;
  }
}
